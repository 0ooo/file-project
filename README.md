# File Upload Application

## Описание

**File Upload Application** — это веб-приложение, позволяющее пользователям эффективно и надёжно загружать большие файлы. Оно разработано для обработки загрузки файлов по частям (чанкам), что обеспечивает следующие возможности:

- **Поддержка больших файлов**: Загрузка файлов любого размера путём разделения их на управляемые чанки.
- **Возобновляемые загрузки**: Продолжение прерванных загрузок без необходимости начинать сначала.
- **Параллельные загрузки**: Одновременная загрузка нескольких чанков для ускорения процесса.
- **Отслеживание прогресса**: Индикация реального времени во время загрузки файла.
- **Сборка на сервере**: Чанки собираются на сервере для восстановления исходного файла.

Приложение состоит из двух компонентов:

1. **File Server** (`file-server`): Серверное приложение на Node.js, которое обрабатывает получение чанков файлов, сохраняет их и собирает полные файлы.

2. **File Uploader** (`file-uploader`): Клиентское приложение на React, которое позволяет пользователям выбирать файлы и загружать их на сервер с отслеживанием прогресса.

## Возможности

- **Загрузка файлов по частям**: Разделение больших файлов на меньшие части для загрузки.
- **Пауза и возобновление**: Автоматическая обработка прерываний и возобновление загрузок при восстановлении соединения.
- **Параллельные загрузки**: Настраиваемое количество одновременных загрузок для оптимизации использования пропускной способности.
- **Сохранение состояния загрузки**: Локальное сохранение состояния загрузки для продолжения даже после закрытия браузера или обновления страницы.
- **Настраиваемый сервер**: Регулируемые параметры сервера для размера чанков, ограничений размера файлов и интервалов очистки.

## Предварительные требования

### Для нативного развертывания

- **Node.js**: Версии 14 или выше (рекомендуется Node.js 21 для этого проекта).
- **npm**: Менеджер пакетов Node.js, поставляется вместе с Node.js.

### Для развертывания с помощью Docker

- **Docker**: Установленный и запущенный.
- **Docker Compose**: Версии 3.8 или выше.

## Установка

Вы можете развернуть приложение нативно на вашей машине или использовать Docker.

### 1. Нативное развертывание

#### Клонирование репозитория

```bash
git clone https://github.com/0ooo/file-project
cd file-project
```

#### A. Настройка File Server

1. Перейдите в директорию `file-server`:

```bash
cd file-server
```

2. Установите зависимости:

```bash
npm install
```

3. Соберите сервер:

```bash
npm run build
```

4. Настройте переменные окружения:

- Создайте файл `.env` в директории `file-server`, если он не существует.
- Скопируйте следующее в `.env`:

```env
# Номер порта сервера
PORT=3002

# Окружение (development или production)
NODE_ENV=development

# Максимальный размер чанка в мегабайтах
MAX_CHUNK_SIZE_MB=400

# Максимальный размер файла в мегабайтах
MAX_FILE_SIZE_MB=2000

# Интервал очистки в миллисекундах (1 минута)
CLEANUP_INTERVAL_MS=60000

# Максимальное время хранения незавершённых загрузок в миллисекундах (5 минут)
MAX_AGE_MS=300000
```

При необходимости отредактируйте эти значения.

5. Запустите сервер:

```bash
npm start
```

Сервер запустится и будет слушать порт 3002.

#### B. Настройка File Uploader

1. Откройте новое окно терминала и перейдите в директорию `file-uploader`:

```bash
cd ../file-uploader
```

2. Установите зависимости:

```bash
npm install
```

3. Настройте переменные окружения:

- Создайте файл `.env` в директории `file-uploader`, если он не существует.
- Скопируйте следующее в `.env`:

```env
# Размер чанка в мегабайтах
REACT_APP_CHUNK_SIZE=100

# Количество параллельных загрузок
REACT_APP_MAX_CONCURRENT_UPLOADS=3

# URL сервера для загрузки файлов
REACT_APP_SERVER_URL=http://localhost:3002
```

Убедитесь, что `REACT_APP_SERVER_URL` указывает на адрес и порт вашего сервера.

4. Запустите клиентское приложение:

```bash
npm start
```

Приложение откроется в вашем браузере по адресу http://localhost:3000.

#### C. Использование приложения

- Перейдите по адресу http://localhost:3000 в вашем браузере, если он не открылся автоматически.
- Выберите файл для загрузки и нажмите «Загрузить».
- Отслеживайте прогресс загрузки.

#### D. Сохранение файлов и логов

- Загруженные файлы сохраняются на хост-машине в директории `file-server/uploads`.
- Логи сервера сохраняются в `file-server/logs`.

### 2. Развертывание с помощью Docker

Вы можете запустить серверное и клиентское приложения в Docker-контейнерах с использованием Docker Compose.

#### A. Предварительные требования

Убедитесь, что Docker и Docker Compose установлены на вашей системе.

#### B. Настройка переменных окружения:

1. Настройте переменные окружения сервера:

- Создайте файл `.env` в директории `file-server`, если он не существует.
- Скопируйте следующее в `.env`:

```env
# Номер порта сервера
PORT=3002

# Окружение (development или production)
NODE_ENV=development

# Максимальный размер чанка в мегабайтах
MAX_CHUNK_SIZE_MB=400

# Максимальный размер файла в мегабайтах
MAX_FILE_SIZE_MB=2000

# Интервал очистки в миллисекундах (1 минута)
CLEANUP_INTERVAL_MS=60000

# Максимальное время хранения незавершённых загрузок в миллисекундах (5 минут)
MAX_AGE_MS=300000
```

При необходимости отредактируйте эти значения.

2. Настройте переменные окружения клиента:

- Создайте файл `.env` в директории `file-uploader`, если он не существует.
- Скопируйте следующее в `.env`:

```env
# Размер чанка в мегабайтах
REACT_APP_CHUNK_SIZE=100

# Количество параллельных загрузок
REACT_APP_MAX_CONCURRENT_UPLOADS=3

# URL сервера для загрузки файлов
REACT_APP_SERVER_URL=http://localhost:3002
```

Убедитесь, что `REACT_APP_SERVER_URL` указывает на адрес и порт вашего сервера.

#### C. Сборка и запуск контейнеров

1. Перейдите в корневую директорию проекта (где находится `docker-compose.yml`):
2. Соберите и запустите контейнеры:

```bash
docker-compose up --build
```

#### D. Доступ к приложению

- Клиентское приложение: Откройте http://localhost:3000 в вашем браузере.

#### E. Сохранение файлов и логов

- Загруженные файлы сохраняются в директории `file-server/uploads`.
- Логи сервера сохраняются в `file-server/logs`.

#### F. Остановка контейнеров

Чтобы остановить контейнеры, нажмите Ctrl + C в терминале, где запущен docker-compose, или выполните:

```bash
docker-compose down
```

## Конфигурация

### Конфигурация сервера (file-server/.env)

- `PORT`: Номер порта, на котором работает сервер.
- `NODE_ENV`: Окружение Node.js (development или production).
- `MAX_CHUNK_SIZE_MB`: Максимальный размер каждого чанка файла в мегабайтах.
- `MAX_FILE_SIZE_MB`: Максимально допустимый размер загружаемого файла в мегабайтах.
- `CLEANUP_INTERVAL_MS`: Интервал в миллисекундах для очистки незавершённых загрузок.
- `MAX_AGE_MS`: Максимальное время в миллисекундах для хранения незавершённых загрузок.

### Конфигурация клиента (file-uploader/.env)

- `REACT_APP_CHUNK_SIZE`: Размер каждого чанка файла в мегабайтах.
- `REACT_APP_MAX_CONCURRENT_UPLOADS`: Количество параллельно загружаемых чанков.
- `REACT_APP_SERVER_URL`: URL сервера для загрузки файлов.

## Устранение неполадок

- **Конфликты портов:** Убедитесь, что порты 3000 (клиент) и 3002 (сервер) не используются другими приложениями.
- **Права доступа:** Если файлы не сохраняются на хосте при использовании Docker, убедитесь, что у Docker есть права на запись в директории `file-server/uploads` и `file-server/logs`.
